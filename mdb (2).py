# -*- coding: utf-8 -*-
"""MDB.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1peZQ4dj1pGnUsTYXF-cv0iaF2JdyExEb
"""

# -*- coding: utf-8 -*-
"""Versi√≥n completa con MongoDB + correcciones de S√≠/No"""

import base64
import secrets
from collections import defaultdict
from pymongo import MongoClient

# ================================
# üîµ  CONEXI√ìN A MONGODB
# ================================
# ‚ö†Ô∏è REEMPLAZA TU CADENA DE MONGODB AQU√ç
MONGO_URI = "mongodb+srv://tavo_user:1234567#@cluster0.cjx2xfb.mongodb.net/?appName=Cluster0"
client = MongoClient(MONGO_URI)
db = client["bricos_db"]
coleccion = db["candidatos"]

# ================================
# üîµ  PAR√ÅMETROS
# ================================
NUM_PREGUNTAS_TECNICAS = 12
NUM_PREGUNTAS_BLANDAS = 13
PUNTAJE_MINIMO_BLANDAS = 0.45

# ================================
# üîµ  CLASE RSA SIMULADA
# ================================
class RSAKeySimulada:
    def __init__(self):
        self.public_key = base64.b64encode(secrets.token_bytes(32)).decode("utf-8")
        self.private_key = base64.b64encode(secrets.token_bytes(32)).decode("utf-8")

def cifrar_rsa_simulado(datos, clave_publica):
    datos_codificados = base64.urlsafe_b64encode(datos.encode("utf-8")).decode("utf-8")
    return f"RSA-256:{clave_publica[:16]}...{datos_codificados[:40]}..."

# ================================
# üîµ  PREGUNTAS T√âCNICAS
# ================================
PREGUNTAS_TECNICAS = [
    "¬øSabe realizar inventarios f√≠sicos y conteos r√°pidos de material de construcci√≥n?",
    "¬øHa utilizado alg√∫n software de Punto de Venta (POS) o sistema de facturaci√≥n electr√≥nica?",
    "¬øSabe leer e interpretar una hoja de ruta o usar GPS para optimizar entregas?",
    "¬øTiene experiencia o conoce el manejo b√°sico de un montacargas o pat√≠n hidr√°ulico?",
    "¬øPuede identificar y diferenciar los tipos de cemento, varilla y arena comunes en la construcci√≥n?",
    "¬øSabe c√≥mo se calcula el volumen o √°rea de un material (ej. m¬≥ de arena, m¬≤ de loseta)?",
    "¬øSe siente c√≥modo manejando una terminal bancaria y realizando cobros con tarjeta?",
    "¬øPuede verificar y cotejar una orden de compra contra el material f√≠sico que se va a cargar?",
    "¬øConoce las normas b√°sicas de seguridad para cargar y descargar materiales pesados?",
    "¬øTiene conocimientos b√°sicos de uso de hojas de c√°lculo (Excel, Google Sheets) para reportes?",
    "¬øSabe realizar el mantenimiento b√°sico o limpieza de herramientas y equipos de trabajo?",
    "¬øPuede calcular r√°pidamente el cambio para un pago en efectivo?"
]

PREGUNTAS_BLANDAS = [
    "¬øMantiene la calma y es cort√©s al tratar con un cliente enojado o impaciente?",
    "¬øSe adapta f√°cilmente a los cambios de tareas o prioridades de √∫ltima hora?",
    "¬øOfrece ayuda a sus compa√±eros sin que se lo pidan?",
    "¬øEs puntual y respeta estrictamente los horarios?",
    "¬øAcepta retroalimentaci√≥n sin ponerse a la defensiva?",
    "¬øSe enfoca en soluciones en lugar de culpar a otros?",
    "¬øEs proactivo buscando tareas pendientes?",
    "¬øSe comunica de manera clara y concisa?",
    "¬øTrabaja bien bajo presi√≥n?",
    "¬øSu honestidad y √©tica son inquebrantables?",
    "¬øPrioriza la seguridad ante todo?",
    "¬øPropone mejoras a procesos ineficientes?",
    "¬øSe siente c√≥modo pidiendo al cliente verificar la carga/ticket?"
]

# ================================
# üîµ  √ÅREAS
# ================================
AREAS = {
    "CARGADOR":         [0, 3, 4, 7, 8],
    "VENTAS/COBRANZA":  [1, 6, 11],
    "REPARTIDOR":       [2, 3, 7, 8],
    "LIMPIEZA":         [10],
    "ADMINISTRATIVO":   [9, 1, 5]
}

def asignar_area(respuestas):
    conteo = defaultdict(int)
    for area, indices in AREAS.items():
        conteo[area] = sum(1 for i in indices if respuestas[i] == "S√≠")

    if not any(conteo.values()):
        return max(AREAS, key=lambda a: len(AREAS[a]))

    return max(conteo, key=conteo.get)

# ================================
# üîµ  SELECCI√ìN DE √ÅREA DESEADA
# ================================
def seleccionar_area_deseada():
    opciones = {
        "1": "CARGADOR",
        "2": "VENTAS/COBRANZA",
        "3": "REPARTIDOR",
        "4": "LIMPIEZA",
        "5": "ADMINISTRATIVO"
    }

    print("\n--- PUESTO AL QUE DESEAS APLICAR ---")
    for k, v in opciones.items():
        print(f"{k}. {v}")

    while True:
        eleccion = input("Elige una opci√≥n (1-5): ").strip()
        if eleccion in opciones:
            return opciones[eleccion]
        print("Opci√≥n no v√°lida.")

# ================================
# üîµ  DATOS PERSONALES
# ================================
def pedir_datos_personales():
    def pedir(m):
        while True:
            x = input(m).strip()
            if x:
                return x
            print("No puede quedar vac√≠o.")

    print("\n--- DATOS PERSONALES ---")
    return {
        "nombre": pedir("Nombre completo: "),
        "edad": pedir("Edad: "),
        "sexo": pedir("Sexo (M/F/Otro): "),
        "correo": pedir("Correo electr√≥nico (se cifrar√°): "),
        "telefono": pedir("N√∫mero de tel√©fono (se cifrar√°): ")
    }

# ================================
# üîµ  CUESTIONARIOS (S√≠ / No corregido)
# ================================
def realizar_cuestionario(preguntas, tipo):
    puntaje = 0
    respuestas = []

    print(f"\n--- HABILIDADES {tipo.upper()} ---")
    for i, p in enumerate(preguntas):
        while True:
            r = input(f"{i+1}. {p} (S/N): ").upper().strip()
            if r in ("S", "N"):
                respuestas.append("S√≠" if r == "S" else "No")
                if r == "S":
                    puntaje += 1
                break
            print("Respuesta inv√°lida.")
    return puntaje, respuestas

# ================================
# üîµ  EVALUACI√ìN
# ================================
def evaluar(pt_tecnico, pt_blando):
    return (
        (pt_blando / NUM_PREGUNTAS_BLANDAS) >= PUNTAJE_MINIMO_BLANDAS,
        (pt_tecnico / NUM_PREGUNTAS_TECNICAS) * 100,
        (pt_blando / NUM_PREGUNTAS_BLANDAS) * 100
    )

# ================================
# üîµ  PROCESO PRINCIPAL
# ================================
def iniciar_proceso_seleccion():
    print("\n========================================")
    print("    üåü SISTEMA DE SELECCI√ìN MUCHACHAM üåü")
    print("========================================")

    datos = pedir_datos_personales()
    area_deseada = seleccionar_area_deseada()

    key = RSAKeySimulada()
    datos_cifrados = cifrar_rsa_simulado(
        f"Email:{datos['correo']}|Tel:{datos['telefono']}",
        key.public_key
    )

    pt_tecnico, resp_tecnicas = realizar_cuestionario(PREGUNTAS_TECNICAS, "T√âCNICAS")
    pt_blando, resp_blandas = realizar_cuestionario(PREGUNTAS_BLANDAS, "BLANDAS")

    aceptado, pct_tec, pct_bla = evaluar(pt_tecnico, pt_blando)
    area_recomendada = asignar_area(resp_tecnicas)

    # =============================
    # üî¥ GUARDAR EN MONGODB
    # =============================
    registro = {
        "nombre": datos["nombre"],
        "edad": datos["edad"],
        "sexo": datos["sexo"],
        "correo_cifrado": datos_cifrados,
        "puesto_deseado": area_deseada,
        "area_recomendada": area_recomendada,
        "puntaje_tecnico": pt_tecnico,
        "puntaje_blando": pt_blando,
        "porcentaje_tecnico": pct_tec,
        "porcentaje_blando": pct_bla,
        "aceptado": aceptado,
        "respuestas_tecnicas": resp_tecnicas,
        "respuestas_blandas": resp_blandas
    }

    coleccion.insert_one(registro)
    print("\nüìå Datos guardados correctamente en MongoDB.\n")

    print("=========== RESULTADO FINAL ===========")
    print(f"Puesto deseado:     {area_deseada}")
    print(f"√Årea recomendada:   {area_recomendada}")
    print(f"T√©cnicas: {pct_tec:.2f}% | Blandas: {pct_bla:.2f}%")
    print("Estado:", "ACEPTADO ‚úÖ" if aceptado else "NO ACEPTADO ‚ùå")
    print("========================================")

# Ejecutar
if __name__ == "__main__":
    iniciar_proceso_seleccion()