# -*- coding: utf-8 -*-
"""MDB.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1peZQ4dj1pGnUsTYXF-cv0iaF2JdyExEb
"""

!pip install streamlit pymongo
import streamlit as st
from pymongo import MongoClient
from datetime import datetime
import pandas as pd

# =========================================
# 1. CONEXIÃ“N A MONGODB
# =========================================
MONGO_URI = "TU_CADENA_MONGODB_AQUI"
client = MongoClient(MONGO_URI)
db = client["evaluaciones"]
col = db["candidatos"]

# =========================================
# 2. PREGUNTAS
# =========================================
PREGUNTAS_TECNICAS = [
    "Â¿Conoce bases de datos?",
    "Â¿Sabe usar SQL?",
    "Â¿Tiene experiencia con Python?",
    "Â¿Sabe trabajar con APIs?",
    "Â¿Ha usado Git/GitHub?",
    "Â¿Conoce Docker?",
    "Â¿Ha usado frameworks web?",
    "Â¿Conoce anÃ¡lisis de datos?",
    "Â¿Sabe usar Excel avanzado?",
    "Â¿Tiene experiencia con ML?",
    "Â¿Comprende redes?",
    "Â¿Ha trabajado en la nube?"
]

PREGUNTAS_BLANDAS = [
    "Â¿Trabaja bien en equipo?",
    "Â¿Se comunica claramente?",
    "Â¿Tolera presiÃ³n laboral?",
    "Â¿Tiene liderazgo?",
    "Â¿Es responsable?",
    "Â¿Llega puntual?",
    "Â¿Resuelve problemas?",
    "Â¿Aprende rÃ¡pido?",
    "Â¿Es adaptable?",
    "Â¿Es creativo?",
    "Â¿Se organiza bien?",
    "Â¿Toma decisiones?",
    "Â¿Es proactivo?"
]

PUNTAJE_MINIMO_BLANDAS = 0.75  # 75% es el mÃ­nimo


# =========================================
# 3. NAVEGACIÃ“N
# =========================================
st.sidebar.title("MenÃº")
pagina = st.sidebar.radio("Ir a:", ["Registrar candidato", "Ver candidatos"])


# =========================================
# 4. PÃGINA: REGISTRO Y EVALUACIÃ“N
# =========================================
if pagina == "Registrar candidato":
    st.title("ðŸ“ Registro de Candidato")

    # --- Datos personales ---
    nombre = st.text_input("Nombre completo")
    correo = st.text_input("Correo electrÃ³nico")
    edad = st.number_input("Edad", 15, 80, 20)

    st.write("---")
    st.header("3. Cuestionario TÃ©cnico")

    respuestas_tecnicas = []
    pt_tecnico = 0

    for i, p in enumerate(PREGUNTAS_TECNICAS):
        r = st.radio(p, ["S", "N"], key=f"tec_{i}")
        respuestas_tecnicas.append(r)
        if r == "S":
            pt_tecnico += 1

    st.write("---")
    st.header("4. Cuestionario de Habilidades Blandas")

    pt_blando = 0
    for i, p in enumerate(PREGUNTAS_BLANDAS):
        r = st.radio(p, ["S", "N"], key=f"bla_{i}")
        if r == "S":
            pt_blando += 1

    # --- CÃ¡lculo ---
    porcentaje_blando = pt_blando / len(PREGUNTAS_BLANDAS)
    aprobado = porcentaje_blando >= PUNTAJE_MINIMO_BLANDAS

    st.write("---")

    if st.button("Guardar evaluaciÃ³n"):
        if nombre == "" or correo == "":
            st.error("Faltan datos del candidato.")
        else:
            documento = {
                "nombre": nombre,
                "correo": correo,
                "edad": edad,
                "tecnico": pt_tecnico,
                "blandas": pt_blando,
                "porcentaje_blandas": round(porcentaje_blando, 2),
                "aprobado": aprobado,
                "fecha_registro": datetime.now()
            }

            col.insert_one(documento)
            st.success("âœ”ï¸ EvaluaciÃ³n guardada en MongoDB correctamente.")


# =========================================
# 5. PÃGINA: VER CANDIDATOS
# =========================================
if pagina == "Ver candidatos":
    st.title("ðŸ“‹ Ver Candidatos Registrados")

    # Filtros
    correo_f = st.text_input("Buscar por correo contiene:")
    min_tecnico = st.number_input("MÃ­nimo puntaje tÃ©cnico", 0, len(PREGUNTAS_TECNICAS), 0)
    min_blandas = st.number_input("MÃ­nimo puntaje blandas", 0, len(PREGUNTAS_BLANDAS), 0)
    solo_aprobados = st.checkbox("Mostrar solo aprobados")

    query = {}

    if correo_f:
        query["correo"] = {"$regex": correo_f, "$options": "i"}

    if min_tecnico > 0:
        query["tecnico"] = {"$gte": min_tecnico}

    if min_blandas > 0:
        query["blandas"] = {"$gte": min_blandas}

    if solo_aprobados:
        query["aprobado"] = True

    # Obtener datos
    datos = list(col.find(query, {"_id": 0}))

    if len(datos) == 0:
        st.warning("No se encontraron candidatos con esos filtros.")
    else:
        df = pd.DataFrame(datos)
        st.dataframe(df)

        st.download_button(
            "Descargar en CSV",
            df.to_csv(index=False).encode("utf-8"),
            "candidatos.csv",
            "text/csv"
        )

MONGO_URI = "mongodb+srv://tavo_user:1234567#@cluster0.cjx2xfb.mongodb.net/?appName=Cluster0"