# -*- coding: utf-8 -*-
"""MUCHACHAM.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1ACuxg_aod4NtOrZqACHQV2bgW31eEWxr
"""

import streamlit as st
import base64
import secrets
from collections import defaultdict

# --- PAR√ÅMETROS ---
NUM_PREGUNTAS_TECNICAS = 12
NUM_PREGUNTAS_BLANDAS = 13
PUNTAJE_MINIMO_BLANDAS = 0.75  # 75%

# --- CLAVE RSA SIMULADA ---
class RSAKeySimulada:
    def __init__(self):
        self.public_key = base64.b64encode(secrets.token_bytes(32)).decode("utf-8")
        self.private_key = base64.b64encode(secrets.token_bytes(32)).decode("utf-8")

def cifrar_rsa_simulado(datos, clave_publica):
    datos_codificados = base64.urlsafe_b64encode(datos.encode("utf-8")).decode("utf-8")
    return f"RSA-256-CIPHER:{clave_publica[:16]}...{datos_codificados[:40]}..."

# --- PREGUNTAS ---
PREGUNTAS_TECNICAS = [
    "¬øSabe realizar inventarios f√≠sicos y conteos r√°pidos de material de construcci√≥n?",
    "¬øHa utilizado alg√∫n software de Punto de Venta (POS) o sistema de facturaci√≥n electr√≥nica?",
    "¬øSabe leer e interpretar una hoja de ruta o usar GPS para optimizar entregas?",
    "¬øTiene experiencia o conoce el manejo b√°sico de un montacargas o pat√≠n hidr√°ulico?",
    "¬øPuede identificar y diferenciar los tipos de cemento, varilla y arena comunes en la construcci√≥n?",
    "¬øSabe c√≥mo se calcula el volumen o √°rea de un material?",
    "¬øSe siente c√≥modo manejando una terminal bancaria y realizando cobros con tarjeta?",
    "¬øPuede verificar y cotejar una orden de compra contra el material f√≠sico?",
    "¬øConoce normas b√°sicas de seguridad en carga/descarga?",
    "¬øTiene conocimientos b√°sicos de Excel o Google Sheets?",
    "¬øSabe realizar mantenimiento b√°sico o limpieza de herramientas?",
    "¬øPuede calcular r√°pidamente el cambio en efectivo?"
]

PREGUNTAS_BLANDAS = [
    "¬øMantiene la calma ante clientes dif√≠ciles?",
    "¬øSe adapta f√°cilmente a cambios?",
    "¬øOfrece ayuda sin que se lo pidan?",
    "¬øEs puntual?",
    "¬øAcepta retroalimentaci√≥n?",
    "¬øBusca soluciones en lugar de culpas?",
    "¬øEs proactivo?",
    "¬øSe comunica claramente?",
    "¬øTrabaja bien bajo presi√≥n?",
    "¬øEs completamente honesto?",
    "¬øPrioriza la seguridad?",
    "¬øPropone mejoras?",
    "¬øPide al cliente verificar carga/ticket?"
]

AREAS = {
    "CARGADOR":         [0, 3, 4, 7, 8],
    "VENTAS/COBRANZA":  [1, 6, 11],
    "REPARTIDOR":       [2, 3, 7, 8],
    "LIMPIEZA":         [10],
    "ADMINISTRATIVO":   [9, 1, 5]
}

def asignar_area(respuestas):
    conteo = defaultdict(int)
    for area, indices in AREAS.items():
        conteo[area] = sum(1 for i in indices if respuestas[i] == "S")
    if not any(conteo.values()):
        return max(AREAS, key=lambda a: len(AREAS[a]))
    return max(conteo, key=conteo.get)

def evaluar_resultados(pt_tecnico, pt_blando):
    pct_tec = (pt_tecnico / NUM_PREGUNTAS_TECNICAS) * 100
    pct_bla = (pt_blando / NUM_PREGUNTAS_BLANDAS) * 100
    es_aceptado = pct_bla >= (PUNTAJE_MINIMO_BLANDAS * 100)
    return es_aceptado, pct_tec, pct_bla

# --- STREAMLIT APP ---
st.title("üåü Sistema de Selecci√≥n BRICOS (WebApp)")

st.header("1. Datos personales")
nombre = st.text_input("Nombre completo")
edad = st.text_input("Edad")
sexo = st.selectbox("Sexo", ["M", "F", "Otro"])
correo = st.text_input("Correo electr√≥nico")
telefono = st.text_input("N√∫mero telef√≥nico")

st.header("2. Puesto deseado")
puesto = st.selectbox(
    "Selecciona el puesto al que deseas aplicar",
    ["CARGADOR", "VENTAS/COBRANZA", "REPARTIDOR", "LIMPIEZA", "ADMINISTRATIVO"]
)

st.header("3. Cuestionario T√©cnico")
respuestas_tecnicas = []
pt_tecnico = 0
for i, p in enumerate(PREGUNTAS_TECNICAS):
    r = st.radio(p, ["S", "N"], key=f"tec_{i}")
    respuestas_tecnicas.append(r)
    if r == "S":
        pt_tecnico += 1

st.header("4. Cuestionario de Habilidades Blandas")
pt_blando = 0
for i, p in enumerate(PREGUNTAS_BLANDAS):
    r = st.radio(p, ["S", "N"], key=f"bla_{i}")
    if r == "S":
        pt_blando += 1

if st.button("üü¶ Evaluar Candidato"):
    keygen = RSAKeySimulada()
    datos_cifrados = cifrar_rsa_simulado(
        f"Email:{correo}|Tel:{telefono}",
        keygen.public_key
    )

    aceptado, pct_tec, pct_bla = evaluar_resultados(pt_tecnico, pt_blando)
    area_recomendada = asignar_area(respuestas_tecnicas)

    st.subheader("üìå RESULTADO FINAL")
    st.write(f"**Puesto deseado:** {puesto}")
    st.write(f"**√Årea recomendada:** {area_recomendada}")
    st.write(f"**T√©cnicas:** {pt_tecnico} / {NUM_PREGUNTAS_TECNICAS} ‚Üí {pct_tec:.2f}%")
    st.write(f"**Blandas:** {pt_blando} / {NUM_PREGUNTAS_BLANDAS} ‚Üí {pct_bla:.2f}%")

    if aceptado:
        st.success("‚úÖ ACEPTADO")
    else:
        st.error("‚ùå NO ACEPTADO (fallo en habilidades blandas)")

    if area_recomendada == puesto:
        st.info("‚≠ê Tu perfil t√©cnico coincide con tu puesto deseado.")
    else:
        st.warning(f"üí° Sugerencia: {area_recomendada} es mejor ajuste seg√∫n tus habilidades.")

    st.subheader("üîê Datos cifrados:")
    st.code(datos_cifrados)